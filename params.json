{"name":"QTLpvl","tagline":"testing of pleiotrophy vs close linkage","body":"R package still in working...\r\n\r\n[![Build Status](https://travis-ci.org/jianan/qtlpvl.png?branch=master)](https://travis-ci.org/jianan/qtlpvl)\r\n\r\n# Introduction to qtlpvl\r\n\r\nThis package is focusing on QTL mapping with multiple traits and\r\ntesting of pleiotrophy vs. close linkage.\r\n\r\n\r\n## Data\r\n\r\nWe use data `listeria` from `R\\qtl` as an example. We will be only\r\nusing the genotypes of this F$_2$ population and generate the\r\nphenotypes from normal distribution.\r\n\r\n\r\n```r\r\nset.seed(92950640)\r\ndata(listeria)\r\nlisteria <- calc.genoprob(listeria,step=1)\r\nn <- nind(listeria)\r\nchr <- \"1\"\r\ngeno <- pull.geno(listeria, chr=chr)\r\ngenotype1 <- geno[,7]\r\ngenotype2 <- geno[,10]\r\n(pos <- unlist(pull.map(listeria, chr=chr))[c(7,10)])\r\n```\r\n\r\n```\r\n#> 1.D1M451 1.D1M355 \r\n#>    70.11    81.40\r\n```\r\n\r\n```r\r\np <- 10\r\np1 <- floor(p/2)\r\nG1 <- matrix(genotype1, n, p1)\r\nG2 <- matrix(genotype2, n, p-p1)\r\nG2[G2==3] <- 2\r\nG <- cbind(G1, G2*(-2))\r\nY <- matrix(rnorm(n*p),n,p)\r\nY <- Y + G\r\n```\r\n\r\n\r\nIn the above code, after setting the random seed, we load the data\r\n`listeria` and pull out the genotype data from the cross object\r\n`listeria` on chromosome 1 as a data matrix `geno`, which is of\r\nsize 120 $\\times$ 13. We pick the 7th and 10th marker as\r\nthe two QTLs and save their genotypes in `genotype1` and\r\n`genotype2`. These two QTLs are at position 70.11\r\ncM and 81.40 cM on chromosome 1.\r\n\r\nAssume the first QTL have additive effect only and the second QTL have\r\ndominant effect --individuals with genotype 2 and 3 are grouped\r\ntogether to have the same shift in mean.  The first 5 traits are\r\ncontrolled by the first QTL and the other 5 trait of the total 10 are\r\ncontrolled by the second QTL with negative effect.  We use matrix G to\r\nsave the QTL effects and the second QTL group, `G2` is multiply by -2\r\nto have a negative QTL effect.  The 10 phenotypes are generated with\r\nthese QTL effect matrix G plus independent noise generated from\r\nstandard normal distribution.\r\n\r\nWe could first look at the single triat analysis result.  For each\r\ntrait, we plot its LOD score versus QTL position when the LOD is\r\nbigger than a threshold (default value is 3).\r\n\r\n\r\n```r\r\nplotLOD(listeria, Y, chr)\r\n```\r\n\r\n![plot of chunk unnamed-chunk-3](figure/unnamed-chunk-3.png) \r\n\r\n\r\n\r\n## joint mapping: `scanone.mvn`\r\n\r\nHaving the cross object `listeria` and phenotype trait matrix `Y`\r\nprepared, we can first run a joint mapping with `scanone.mvn`, which\r\nassumes multivariate normal model. chr is set to be \"1\", which\r\nindicates the mapping is only on chromosome 1. Function `scanone.mvn`\r\nhas two more parameters `addcovar` and `intcovar`, they could be used\r\nto control for additive and interactive covariates when needed.\r\n\r\nThe result of joint mapping is a data frame with class `scanone`, we\r\ncould apply (S3) method `summary` and `plot` to look at the result.\r\n\r\n\r\n```r\r\nout <- scanone.mvn(listeria, Y, chr)\r\nsummary(out)\r\n```\r\n\r\n```\r\n#>          chr pos  lod\r\n#> c1.loc78   1  78 63.5\r\n```\r\n\r\n```r\r\nplot(out)\r\n```\r\n\r\n![plot of chunk unnamed-chunk-4](figure/unnamed-chunk-4.png) \r\n\r\n\r\nWe could see the QTL is at 78.00 cM\r\nwith LOD score 63.46.\r\n\r\n## test of 1 vs 2 QTL: `testpleio.1vs2`\r\n\r\nWe test the hypothesis of: \r\n* $H_0$: There is only one QTL affecting all the phenotypes;\r\n* $H_1$: There are two QTLs, each affecting one of the two phenotype\r\n  groups.\r\n\r\nWe assume the traits follow multivariate normal distribution and\r\nperform joint mapping to locate the single-QTL under the null\r\nhypothesis that there is one pleiotrophic QTL affecting all the\r\ntraits; we then run single trait analysis on each trait and find the\r\ntrait-specific QTL, sort the traits by their QTL position and search\r\nfor the best separation of the traits into two groups, where the first\r\ngroup (contains the first several traits) is controlled by the right\r\nQTL and the second group (contains the rest traits) is controlled by\r\nthe left QTL. The LOD score of this two-QTL model is then subtracted\r\nby the LOD score of the single-QTL model to arrived at the final test\r\nstatistic.\r\n\r\nTo get the null distribution of the statistics, we have two methods:\r\n* parametric bootstrap: generate data from the parameters estimated\r\n  under the null hypothesis\r\n* stratified permutation: randomly permute the genotype data versus\r\n  phenotype data with in each QTL genotype group,\r\n\r\nwe repeat the whole procedure on data from either method and save the\r\ntest statistics. The P-value is calculated from this empirical\r\ndistribution.\r\n\r\nFunction `testpleio.1vs2` is used to do this test. input parameters:\r\n* cross: An object of class `cross`. \r\n* Y: matrix of multiple traits with n rows.\r\n* chr: One character strings referring to chromosome of interest by\r\n  name.\r\n* region.l, region.r: left and right bound for the interval of\r\n  interest.\r\n* int.method: can have value of `bayes` or `1.5lod`, method to\r\n  calculated the interval of interest if `region.l` and `region.r` is\r\n  not specified.\r\n* search: searching method for two-QTL model, can have value of `fast`\r\n  or `complete`, default is `fast`.\r\n* RandomStart: use random starting point for the two-QTL model or not,\r\n  default is `TRUE`.\r\n* RandomCut: use random cutting or not when there are traits mapped to\r\n  the same location. default is \"FALSE\".\r\n* simu: \"parametric\" or \"permutation\" method for simulations. default\r\n  is \"parametric\".\r\n* n.simu: number of simulations for p-value.\r\n* tol: Tolerance value for the `qr` decomposition in `lm` fitting.\r\n* addcovar, intcovar: Additive and interactive covariates to control\r\n  for when mapping.\r\n\r\nThis function will return a list with class `testpleio.1vs2`, similar\r\nto `scanone`, we could apply (S3) method `summary` and `plot` to look\r\nat the result. In the summary, we could see the position and LOD score\r\nfor the single QTL and best two QTL model, as well as test statistics\r\nLODdiff=LOD2-LOD1 and its P-value.\r\n\r\n\r\n```r\r\nobj <- testpleio.1vs2(listeria, Y, chr, n.simu=100, region.l=60, region.r=90)\r\nsummary(obj)\r\n```\r\n\r\n```\r\n#> Single QTL model: lod 63.46, pos 78.00 cM\r\n#> Two QTLs model: lod 81.66, pos 70.11 cM, 81.40 cM\r\n#>   Traits influenced by the left QTL: 1 2 3 4 5\r\n#>   Traits influenced by the right QTL: 6 7 8 9 10\r\n#> Difference of LOD score: 18.20\r\n#> P-value is: 0 (from 100 simulations)\r\n```\r\n\r\n```r\r\nplot(obj)\r\n```\r\n\r\n![plot of chunk unnamed-chunk-5](figure/unnamed-chunk-5.png) \r\n\r\n\r\nThe above figure shows the joint mapping result in black and profile\r\nfor each of the two QTLs under $H_1$:\r\n\r\n* red line: $L_1(\\lambda_1) = \\max_{\\lambda_2} LOD2(\\lambda_1,\r\n  \\lambda_2)$\r\n* blue line: $L_2(\\lambda_2) = \\max_{\\lambda_1} LOD2(\\lambda_1,\r\n  \\lambda_2)$\r\n\r\nTriangles indicate the position of the QTLs and solid points indicate\r\nQTL positions and LODs from single trait mapping.\r\n\r\nWe could also use `plottrace` to see how LODdiff changes when we move\r\nthe cut-point of the left versus right group. There are 7 possible QTL\r\npositions from the above plot (result of single trait mapping), thus\r\nwe have 6 possible ways of grouping these positions into the left\r\nversus right group. The 6 open dot indict the cut and their LODdiff.\r\nThus when the first 5 traits and the last 5 traits are grouped\r\nseparately, the LODdiff is the biggest, it is our best two QTL model.\r\nThis figure could be used as a diagnostic figure, to see if our best\r\ntwo QTL model is better than the rest of all the possible models.\r\n\r\n\r\n```r\r\nplottrace(obj)\r\n```\r\n\r\n![plot of chunk unnamed-chunk-6](figure/unnamed-chunk-6.png) \r\n\r\n\r\n## test of 1 vs p QTL: `testpleio.1vsp`\r\n\r\nWe could also test the hypothesis of:\r\n* $H_0$: There is only one QTL affecting all the phenotypes; \r\n* $H_1$: There are p QTLs, each affecting one of the phenotypes, i.e.,\r\n  each phenotype is allowed to has its own QTL.\r\n\r\nThis function has much less parameters than the previous one. We have\r\n`cross`, `Y`, `chr`, `addcovar`, `intcovar` and `n.simu`, the usage is\r\nsame as before.  This function will return a list with class\r\n`testpleio.1vsp`, similar to `scanone` and `testpleio.1vs2`, we could\r\napply (S3) method `summary` and `plot` to look at the result.  In the\r\nsummary, we could see the position and LOD score for the single QTL\r\nand p QTL model, as well as test statistics LODdiff=LODp-LOD1 and its\r\nP-value.\r\n\r\n\r\n```r\r\nobj2 <- testpleio.1vsp(listeria, Y, chr, n.simu=100)\r\nsummary(obj2)\r\n```\r\n\r\n```\r\n#> Single QTL model: lod 63.46, pos 78.00 cM\r\n#> Multiple QTLs model: lod 82.28\r\n#>     Triat   POS    LOD\r\n#> X1      1 70.11 10.863\r\n#> X2      2 70.11 10.174\r\n#> X3      3 69.00  9.896\r\n#> X4      4 70.11 14.309\r\n#> X5      5 68.00  9.652\r\n#> X6      6 80.62 18.919\r\n#> X7      7 79.00 17.460\r\n#> X8      8 81.40 17.945\r\n#> X9      9 82.00 15.928\r\n#> X10    10 81.40 16.367\r\n#> \r\n#> Difference of LOD score: 18.82\r\n#> P-value is: 0 (from 100 simulations)\r\n```\r\n\r\n```r\r\nplot(obj2)\r\n```\r\n\r\n![plot of chunk unnamed-chunk-7](figure/unnamed-chunk-7.png) \r\n\r\n\r\n## plot Genetic Pattern: `plotGenetpattern`\r\n\r\nTo illustrate the use of exploration plots, we generate data with more\r\nnumber of traits, 100. Same as before, the first half of the traits\r\nare controlled by the first QTL and the rest are controlled by the\r\nsecond QTL.\r\n\r\n\r\n```r\r\np <- 100\r\np1 <- floor(p/2)\r\nG1 <- matrix(genotype1, n, p1)\r\nG2 <- matrix(genotype2, n, p-p1)\r\nG2[G2==3] <- 2\r\nG <- cbind(G1, G2*(-2))\r\nY <- matrix(rnorm(n*p),n,p)\r\nY <- Y + G\r\n```\r\n\r\n\r\nFunction `plotGenetpattern` takes two kinds of input parameters:\r\n* a phenotype matrix `Y` and a genotype vector `genotype`, the later\r\n  should be genotype of the common QTL in most suspicious.\r\n* a phenotype matrix `Y` and a cross object and chromosome\r\n  number. This is used when there is no certainty of a single QTL for\r\n  all traits and thus each trait is mapped separately and its own QTL\r\n  genotype is used.\r\n  \r\nQTL additive effect is defined as a=(RR-BB)/2, QTL dominant effect is\r\ndefined as d=BR-(BB+RR)/2, when plotted against each other, traits\r\nwith pure additive effects are near the x-axis and traits with\r\ndominant effects are along the diagonals, $y=x$ and $y=-x$.\r\n\r\n\r\n```r\r\nplotGenetpattern(Y, genotype=genotype1)\r\n```\r\n\r\n![plot of chunk unnamed-chunk-9](figure/unnamed-chunk-91.png) \r\n\r\n```r\r\nplotGenetpattern(Y, cross=listeria, chr=chr)\r\n```\r\n\r\n![plot of chunk unnamed-chunk-9](figure/unnamed-chunk-92.png) \r\n\r\n\r\nWe can tell from both plots the there are two different genetic\r\npatterns, thus possible two different QTLs, even if they are closely\r\nlinked.\r\n\r\n## plot LOD score with sign: `plotLODsign` \r\n\r\nUsing the same data, we could also display the direction of the QTL\r\neffect with `plotLODsign`.  Function `plotLODsign` takes input\r\n`cross`, `Y` and `chr`, as well as `addcovar` and `intcovar`, all has\r\nbeen introduced above.\r\n\r\nFor each trait, the QTL effect direction is used as the sign of the\r\nLOD score. We first run single trait mapping for LOD scores and QTL\r\npositions, then we use `argmax.geno` to impute QTL genotypes and\r\ncalculate mean for each of the 3 genotype group. We define the\r\ndirection positive when the mean of the first group is bigger than the\r\nmean of the third group, and negative while not.\r\n\r\n\r\n```r\r\nplotLODsign(listeria, Y, chr)\r\n```\r\n\r\n![plot of chunk unnamed-chunk-10](figure/unnamed-chunk-10.png) \r\n\r\n\r\n## Session Info\r\n\r\n```r\r\nsessionInfo()\r\n```\r\n\r\n```\r\n#> R version 3.0.2 (2013-09-25)\r\n#> Platform: x86_64-apple-darwin10.8.0 (64-bit)\r\n#> \r\n#> locale:\r\n#> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\r\n#> \r\n#> attached base packages:\r\n#> [1] parallel  stats     graphics  grDevices utils     datasets  methods  \r\n#> [8] base     \r\n#> \r\n#> other attached packages:\r\n#> [1] qtlpvl_0.1     qtl_1.29-2     knitr_1.5      devtools_1.4.1\r\n#> \r\n#> loaded via a namespace (and not attached):\r\n#> [1] digest_0.6.3   evaluate_0.5.1 formatR_0.9    httr_0.2      \r\n#> [5] memoise_0.1    RCurl_1.95-4.1 stringr_0.6.2  tools_3.0.2   \r\n#> [9] whisker_0.3-2\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}